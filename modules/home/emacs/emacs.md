For my emacs home-manager module, override the emacs package with the options provided from  https://github.com/NixOS/nixpkgs/blob/nixos-unstable/pkgs/applications/editors/emacs/make-emacs.nix  and have the following options: withPtk = true, withImageMagick=true, withNativeCompilation = aot, withMailutils = false; withSelinux =false, withAcl = false. Search the web before writing anything. NativeCompilation should be ahead of time. The above options may be overriden by assert made in the provided file
